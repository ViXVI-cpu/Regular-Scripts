local UILibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/ViXVI-cpu/Regular-Scripts/refs/heads/main/Ui%20Library"))

local players = game:GetService("Players")
local plr = players.LocalPlayer
local character = plr.Character or plr.CharacterAdded:Wait()

local function CheckRole(plr: Player)
	local char = plr.Character or plr.CharacterAdded:Wait()
	
	if plr.Backpack:FindFirstChild("Gun") or char:FindFirstChild("Gun") then
		return "Sherrif"
	elseif plr.Backpack:FindFirstChild("Knife") or char:FindFirstChild("Knife") then
		return "Murderer"
	else
		return "Innocent"
	end
end

local colourTable = {
	Green = Color3.fromRGB(0, 255, 0),
	Blue = Color3.fromRGB(0, 0, 255),
	Red = Color3.fromRGB(255, 0, 0),
	Yellow = Color3.fromRGB(255, 255, 0),
	Orange = Color3.fromRGB(255, 165, 0),
	Purple = Color3.fromRGB(128, 0, 128)
}

local colourChosen = colourTable.Yellow -- Change this to your preferred color

local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local espon = false

local espitems = false

local autofarm = false

local function getCharacter(player)
	return player.Character or Workspace:FindFirstChild(player.Name)
end

local function createBillboard(player, character)
	local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
	if humanoidRootPart and not character:FindFirstChild("ESPBillboard") then
		local billboardGui = Instance.new("BillboardGui")
		billboardGui.Name = "ESPBillboard"
		billboardGui.Parent = character
		billboardGui.Adornee = humanoidRootPart
		billboardGui.Size = UDim2.new(0, 200, 0, 50) -- Size of the billboard
		billboardGui.StudsOffset = Vector3.new(0, 3, 0) -- Position above player
		billboardGui.AlwaysOnTop = true

		local textLabel = Instance.new("TextLabel")
		textLabel.Parent = billboardGui
		textLabel.Size = UDim2.new(1, 0, 1, 0)
		textLabel.BackgroundTransparency = 1
		textLabel.TextColor3 = Color3.new(1, 1, 1) -- White text color
		textLabel.Font = Enum.Font.SourceSansBold
		textLabel.TextSize = 16
		textLabel.Text = player.DisplayName .. " (0 studs)" -- Initial text (will be updated)
	end
end

-- Update the Billboard GUI (update username and distance)
local function updateBillboard(player, character)
	local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
	local billboardGui = character:FindFirstChild("ESPBillboard")

	if billboardGui and humanoidRootPart and character and character:FindFirstChild("HumanoidRootPart") then
		local distance = (character.HumanoidRootPart.Position - humanoidRootPart.Position).magnitude
		local textLabel = billboardGui:FindFirstChildOfClass("TextLabel")
		if textLabel then
			textLabel.Text = string.format("%s (%.0f studs)", player.DisplayName, distance) -- Display in studs
		end
	end
end

local function addESPToCharacter(player, character)
	if player == plr then return end -- Skip the local player
	if not character then return end -- Ensure character exists

	if not character:FindFirstChild("Highlight") then
		local highlightClone = Instance.new("Highlight")
		highlightClone.Name = "Highlight"
		highlightClone.Adornee = character
		highlightClone.Parent = character
		highlightClone.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
		highlightClone.FillColor = colourChosen
		highlightClone.OutlineColor = Color3.fromRGB(255, 255, 255)
		highlightClone.FillTransparency = 0.5
	end

	createBillboard(player, character)
end

local function removeESPFromCharacter(character)
	if character then
		local highlightInstance = character:FindFirstChild("Highlight")
		if highlightInstance then
			highlightInstance:Destroy()
		end

		local billboardInstance = character:FindFirstChild("ESPBillboard")
		if billboardInstance then
			billboardInstance:Destroy()
		end
	end
end

local function updateESP()
	for _, player in pairs(players:GetPlayers()) do
		local character = getCharacter(player)
		if character then
			if espon then
				addESPToCharacter(player, character)
				updateBillboard(player, character)
			else
				removeESPFromCharacter(character)
			end
		end
	end
end

local function GetItems()
	for _, item in pairs(workspace:GetDescendants()) do
		if not item:FindFirstChildOfClass("BoxHandleAdornment") then
			if (item.Name == "Coin_Server" and item:IsA("Part")) or (item.Name == "GunDrop" and item:IsA("Tool")) then
				box = Instance.new("BoxHandleAdornment")
				box.Size = item.Size
				box.AlwaysOnTop = true
				box.Transparency = 0.8
				box.ZIndex = 10
				box.Color3 = item.Name == "GunDrop" and colourTable.Blue or colourTable.Yellow
			end
		end
	end
	
	box.Visible = espitems
end

local function farmCoins()
	if not autofarm then return end
	
	for _, v in pairs(workspace:GetDescendants()) do
		if v.Name == "Coin_Server" and v:IsA("Part") then
			character:PivotTo(v.CFrame)
		end
	end
end

local ui = UILibrary.new({
	TitleText = "MM2 Cheats", -- change title text
	Size = UDim2.new(0, 175, 0, 225), -- change Size
	Position = UDim2.new(0.5, -140, 0.5, -190), -- change position when UI starts
	TitleHeight = 30,
	CornerRadius = 6,
	ElementPadding = 6,
	Font = Enum.Font.GothamSemibold,
	TextSize = 12,
	SectionHeight = 20,
	UIStrokeThickness = 1,
	SliderColor = Color3.fromRGB(54, 54, 54)
})

-- Elements

local section1 = ui:AddSection("Main") -- section

-- Toggle
local toggle = ui:AddToggle({
	Text = "ESP",
	Default = false,
	Callback = function(state)
		espon = state
	end
})

local textBox = ui:AddTextBox({
	Text = "Go to:",
	Default = "nil",
	Placeholder = "Go to:",
	Callback = function(text)
		local target = players:FindFirstChild(text)

		if target then
			character:PivotTo(target.Character.HumanoidRootPart.CFrame)
		else
			ui:Notify({
				Title = "Error",
				Text = "Player not found",
				Duration = 3,
				StartPosition = UDim2.new(1, 0, 0.776, 0),
				EndPosition = UDim2.new(0.724, 0, 0.776, 0),
				TweenTime = 0.5
			})
		end
	end
})

ui:AddTextBox({
	Text = "Get role",
	Default = "nil",
	Placeholder = "Player",
	Callback = function(text)
		local plr = players:FindFirstChild(text)

		if plr then
			local role = CheckRole(plr)

			if role then
				ui:Notify({
					Title = "Role",
					Text = plr.Name.." Role is: "..role,
					Duration = 3,
					StartPosition = UDim2.new(1, 0, 0.776, 0),
					EndPosition = UDim2.new(0.724, 0, 0.776, 0),
					TweenTime = 0.5
				})
			end
		else
			ui:Notify({
				Title = "Error",
				Text = "Player not found",
				Duration = 3,
				StartPosition = UDim2.new(1, 0, 0.776, 0),
				EndPosition = UDim2.new(0.724, 0, 0.776, 0),
				TweenTime = 0.5
			})
		end
	end
})

ui:AddToggle({
	Text = "Xray",
	Default = false,
	Callback = function(state)
		for _, obj in pairs(workspace:GetDescendants()) do
			if obj:IsA("BasePart") then
				local char = obj:FindFirstAncestorOfClass("Model")
				local isCharacter = char and char:FindFirstChildOfClass("Humanoid")

				if isCharacter then
					obj.Transparency = 0
				else
					obj.Transparency = state and 0.8 or 0
				end
			end
		end
	end
})

ui:AddSeparator()
ui:AddSection("Farm")

ui:AddToggle({
	Text = "ESP Items",
	Default = false, -- change default true Toggled On / False Toggled Off
	Callback = function(state)
		espitems = state
	end
})

ui:AddButton({
	Text = "Collect All Coins",
	
	Callback = function()
		for _, v in pairs(workspace:GetDescendants()) do
			if v.Name == "Coin_Server" and v:IsA("Part") then
				character:PivotTo(v.CFrame)
			end
		end
	end,
})

ui:AddToggle({
	Text = "Auto farm",
	Default = false, 
	Callback = function(state)
		autofarm = state
	end
})

ui:AddSeparator()

local section3 = ui:AddSection("Player")

ui:AddSlider({
	Text = "Walkspeed",
	Default = 16,
	Min = 0,
	Max = 200,
	
	Callback = function(num)
		character.Humanoid.WalkSpeed = num
	end,
})

ui:AddSlider({
	Text = "JumpPower",
	Default = 50,
	Min = 0,
	Max = 200,

	Callback = function(num)
		character.Humanoid.JumpPower = num
	end,
})
	
ui:AddSeparator()

local section4 = ui:AddSection("Ui Controls")

ui:AddButton({
	Text = "Destroy Ui",
	Callback = function()
		ui:Destroy()
	end
})

ui:AddSeparator()

local section4 = ui:AddSection("Credits")

ui:AddLabel("Made By SugaBlaz")
ui:AddLabel("Thanks to: Hmmm5650 for this cool ui library!")

ui:AddSeparator()

ui:Notify({
	Title = "Loaded",
	Text = "Thanks for using this",
	Duration = 3,
	StartPosition = UDim2.new(1, 0, 0.776, 0),
	EndPosition = UDim2.new(0.724, 0, 0.776, 0),
	TweenTime = 0.5
})

players.PlayerAdded:Connect(function(player)
	player.CharacterAdded:Connect(function(character)
		if espon then
			addESPToCharacter(player, character)
		end
	end)
end)

players.PlayerRemoving:Connect(function(playerRemoved)
	local character = getCharacter(playerRemoved)
	if character then
		removeESPFromCharacter(character)
	end
end)

RunService.RenderStepped:Connect(function()
	updateESP()
	GetItems()
	farmCoins()
end)
